{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to the documentation of Ge\u00fcbt-Validate","text":"<p>This is the Core module of NRW-GE\u00dcBT.</p> <p>Users provided metadata and assemblies are processed with the BfR pipelines chewie-snake and bakcharak to identify clusters and characterize isolates. Results and MEtadata are saved in a local MongoDB database. Data for the new assemblies are saved to the database and cluster information is updated.</p>"},{"location":"contributing/","title":"Contribution guide","text":"<p>Maintaining a repository is a lot of work and it is only possible with the input for its users. That's why we love to get your feedback and continuously improve! We want to contibuting to this project as easy and transparent as possible. That's why we ask all contributions to go through a GitHub workflow.</p>"},{"location":"contributing/#ask-a-question-report-a-bug-or-suggest-new-features","title":"Ask a question, report a bug, or suggest new features","text":"<p>Wether you wish to report a bug, discuss the current state of the code, how to use it, or propose new features, the GitHub repository is the place to start.</p> <p>Go to 'Issues' in the repository's menu and use the search bar to look for your issue/question, maybe the discussion already exists! if you don't find what you are looking for, use the green button 'New Issue' and select the correct template (Question, Bug report or New feature).</p>"},{"location":"contributing/#bug-reports","title":"Bug reports","text":"<p>Solving Bugs is not always easy and usually requires to be able to precisely understand what happened. Try to include the following in your report, so we can solve the problems quickly:</p> <ul> <li>A quick summary and/or background</li> <li>The software versions</li> <li>A precise description of the problem</li> <li>Join input data that reproduce the problem if possible</li> <li>Attach relevant log files to the issue</li> </ul>"},{"location":"contributing/#improving-the-documentation","title":"Improving the documentation","text":"<p>Writting a documentation is a big task and we are gratefull for any help to expand and improve it.</p> <p>If you find a specific section of the documentaiton unclear, or would like to see it in other languages, we would love to hear about it, or if you feel like it, try suggesting modifications.</p>"},{"location":"contributing/#writting-tests","title":"Writting tests","text":"<p>The critical parts of the workflow are currently verified by unit tests. These could always be improved and/or expanded. If you like to write tests, check the <code>.tests/unit</code> folder and suggest changes.</p>"},{"location":"contributing/#submitting-changes","title":"Submitting changes","text":"<p>All changes in the repository are made through pull requests.</p>"},{"location":"contributing/#github-worflow","title":"Github worflow","text":"<p>To submitt a pull request:</p> <ul> <li>Fork the repository and create your branch from <code>main</code></li> <li>Make your changes to the code base/documentation/tests</li> <li>If you have added code that shoul dbe testes, add tests</li> <li>If you have changed the parameters or formating of the inputs, update the documentation</li> <li>Ensure that your code passes the tests and lints, this will be automatically   tested when you submit your pull request</li> <li>Issue your pull request and wait for a maintainer to review the changes</li> </ul> <p>Please provide precise and sufficient information on the changes you performed when you submit your pull request.</p>"},{"location":"contributing/#tests","title":"Tests","text":"<p>It is a good idea to locally run tests before submitting your pull request.</p>"},{"location":"contributing/#unit-tests","title":"Unit tests","text":"<p>We use pytest for running unit tests. Make sure your current environment supports a recent version of python (3.9 or 3.10).</p> <pre><code>python -m pip install --upgrade pip\npip install pytest\npip install -r .tests/unit/requirements.txt  # Install tests dependencies\npytest .tests/unit\n</code></pre>"},{"location":"contributing/#integration-test","title":"Integration test","text":"<p>It is always a good idea to verify that the workflow runs properly as a whole. For this follow this steps:</p> <p>Unpack the cgMSLT scheme:</p> <pre><code>mkdir -p .tests/integration/data/Ruppitsch_chewbbacca\ntar -xzf .tests/integration/data/Ruppitsch_chewbbacca.tar.gz -C .tests/integration/data/Ruppitsch_chewbbacca --strip-components 1\n</code></pre> <p>Create a test database, this requires an environement with pymongo installed:</p> <pre><code>conda create mongod -c conda-forge pymongo\nconda activate mongod\npython .tests/testdb/make_test_db.py\n</code></pre> <p>finally activate a conda enviroment with a recent version of snakemake (see the documentation) and run the following test:</p> <pre><code>conda activate snakemake\nsnakemake --cores 1 --use-conda --configfile .tests/integration/config/config.yaml\n</code></pre> <p>You can clean up the test database by running the following:</p> <pre><code>conda activate mongod\npython .tests/testdb/cleanup_db.py\n</code></pre>"},{"location":"contributing/#license","title":"License","text":"<p>By submitting changes to this repository, you agree that your contributions will be licensed under its BSD-3 Clauses License.</p>"},{"location":"dev_guide/","title":"Guide for developers","text":""},{"location":"dev_guide/#data-validation","title":"Data validation","text":"<p>To modify the data validation schema, see the documentation of the validation module.</p>"},{"location":"dev_guide/#adding-organisms","title":"Adding organisms","text":"<p>To add new organism you need to : - add the validation parameters to the schema (see validation module documentation) - add parameters to the core config</p>"},{"location":"user_guide/","title":"Guide for users","text":""},{"location":"user_guide/#installation","title":"Installation","text":""},{"location":"user_guide/#conda","title":"Conda","text":"<p>Install conda from any distribution, i.e. miniconda. You can follow the setup guide from the Bioconda team.</p> <p>We advise installing the mamaba solver in the base environement to speed up environments creation.</p> <pre><code>conda install mamba -n base -c conda-forge\n</code></pre>"},{"location":"user_guide/#run-environment","title":"Run environment","text":"<p>The running environement simply required a recent python version (&gt;= 3.9) and snakemake. If you followed the steps above just run:</p> <pre><code>mamba create -n snakemake snakemake\n</code></pre>"},{"location":"user_guide/#mongodb","title":"MongoDB","text":"<p>Install the correct MongoDB distribution for your system by following the installation guide</p> <p>Check the documentaiton for database optimization, management, and security.</p>"},{"location":"user_guide/#install-module-and-databases","title":"Install module and databases","text":"<p>Download the latest realease and unpack it.</p> <p>If you're feeling brave, clone the repository form Github:</p> <pre><code>git clone https://github.com/NRW-GEUBT/geuebt-core\n</code></pre> <p>All software and databases dependencies, including the validation and chewie modules will be installed during the first run. It may take a little time so be patient!</p>"},{"location":"user_guide/#cgmlst-schemes","title":"cgMLST schemes","text":"<p>cgMLST schemes need to be provided by the user. A good place to start for these is pubMLST. In general it is recommended to look for schemes that are globally make a consensus for the species of interest.</p> <p>Importantly, the scheme must be formatted to be used by CHEWBBACCA.</p>"},{"location":"user_guide/#configuration","title":"Configuration","text":"<p>The configuaration can be defined in two ways:</p> <ul> <li> <p>either edit and locally save the <code>config/config.yaml</code> files and provide its path   to the snakemake command with the <code>--configfile</code> argument</p> </li> <li> <p>or provide the parameters directly to the snakemake command with   <code>--config &lt;ARGNAME&gt;=&lt;VALUE&gt;</code></p> </li> </ul>"},{"location":"user_guide/#user-defined-parameters","title":"User defined parameters","text":"<p>Following arguments must be provided for each run:</p> Parameter Type Description <code>workdir</code> path-like string Path to the ouptut directory <code>watched_folders</code> list of path-like string Paths to the folders containing input data (metadata and assemblies) <code>fasta_store</code> path-like string Paths to the stroage folder for processed assemblies on the file system"},{"location":"user_guide/#organism-specific-parameters","title":"Organism specific parameters","text":"<p>Organism specific parameters must be provided as a dictionnary whose name is the organism name as provided in the metadata with spaces replaced by underscore and trailing dot stripped (e.g. <code>Campylobacter spp.</code> becomes <code>Campylobacter_spp</code>)</p> <p>Following named parameters are required:</p> Parameter Type Description <code>prodigal</code> path-like string Path to the prodigal training file for this organism.  prodigal training files for many species are &gt;br&gt; provided by the local copy of CHEWBBACCA under  \"~/.nrw-geuebt/chewieSnake/chewBBACA/CHEWBBACA/prodigal_training_files/\" <code>cgmlst_scheme</code> path-like string Path to the cgMLST scheme <code>cluster_distance</code> integer Allele difference threshold for main cluster definition <code>subcluster_distance</code> integer Allele difference threshold for sub-cluster definition <code>cluster_prefix</code> string A short string to use as prefix for cluster naming <code>charak_tag</code> string Species tag for bakcharak, see the documentation to add new species"},{"location":"user_guide/#optional-parameters","title":"Optional parameters","text":"<p>Following parameters are optional and will revert to defaults if not set:</p> Parameter Type Default Description <code>max_threads_per_job</code> integer 1 Max number of threads assigned to a single job <code>geuebt-validate_path</code> path-like string Default installation in <code>~/.nrw-geuebt/</code> Path to the validate module folder <code>geuebt-chewie_path</code> path-like string Default installation in <code>~/.nrw-geuebt/</code> Path to the chewie module folder <code>geuebt-charak_path</code> path-like string Default installation in <code>~/.nrw-geuebt/</code> Path to the charak module folder <code>cleanup_watched_dirs</code> boolean False Whether to delete the data from the watched folder <code>mongodb_host</code> string localhost MongoDB host <code>mongodb_port</code> integer 27017 MongoDB port <code>mongodb_database</code> string geuebt-test Name of the database to store and collect isolates and clusters from <code>validation_min_contig_length</code> integer 500 Minimal contig length (in bp)to be included in the calculation of assemblystatistics <code>max_missing_loci</code> float 0.05 Maximumj fraction of loci missing for sample acceptance <code>distance_method</code> int 3 Distance calculation method for grapetree <code>clustering_method</code> string \"single\" The agglomeration method to be used for hierarchical  clustering. This should be (an unambiguous  abbreviation of) one of \"ward.D\", \"ward.D2\", \"single\",  \"complete\", \"average\" (= UPGMA), \"mcquitty\" (= WPGMA),  \"median\" (= WPGMC) or \"centroid\" (= UPGMC)"},{"location":"user_guide/#usage","title":"Usage","text":"<p>The workflow can be started with:</p> <pre><code>snakemake --use-conda --conda-prefix &lt;PATH TO CONDA ENVS&gt; --configfile &lt;PATH TO CONFIG&gt; --cores &lt;N&gt;\n</code></pre> <p>See the snakemake documentaiton for more information.</p>"},{"location":"user_guide/#input-formats","title":"Input formats","text":""},{"location":"user_guide/#metadata-format","title":"Metadata format","text":"<p>The metadata must be provided as a tab-delimited text data with either of <code>.txt</code>, <code>.csv</code> or <code>.tsv</code> extension, with strict requirements:</p> Field name Required Value Role isolate_id required Free text (unique) Unique data identification in database sample_id required Free text Unique sample identification for epidemiological analysis organism required Choice of ['Salmonella enterica', 'Listeria monocytogenes', 'Escherichia coli', 'Campylobacter spp.'] Sample categorization for downstream analysis isolate_name_alt optional Free text Laboratory internal name isolation_org required Choice of ['MEL', 'OWL', 'RLD', 'RRW', 'WFL, 'unknown'] Establishing chain of custody and for providing contact information sequencing_org required Choice of ['MEL', 'OWL', 'RLD', 'RRW', 'WFL, 'unknown'] Establishing chain of custody and for providing contact information extraction_method optional Free text Facilitates the comparison ofmethodologies, as well asanalyses. library_method optional Free text Facilitates the comparison ofmethodologies, as well asanalyses. sequencing_instrument optional Free text Facilitates the comparison ofmethodologies, as well asanalyses. bioinformatics_org required Choice of ['MEL', 'OWL', 'RLD', 'RRW', 'WFL, 'unknown'] Establishing chain of custody and for providing contact information assembly_method optional Free text Facilitates the comparison ofmethodologies, as well asanalyses. third_party_flag required TRUE or FALSE Mark samples that may be owned by third-party organization third_party_owner required if third_party_flag is TRUE Free text Establishing chain of custody and for providing contact information sample_type required Choice of ['lebensmittel', 'futtermittel', 'tier', 'umfeld', 'human', 'unknown'] Sample categorization for downstream analysis fasta_name required Free text Identification of the sequence data associated to this isolate fasta_md5 required Free text Verification of sequence data integrity collection_date required ISO8601 date YYY-MM-DD or 'unknown' Faciliate epidemiological analysis collection_municipality required Free text (ADV Katalog) or 'unknown' Faciliate epidemiological analysis collection_country required ISO3166 alpha-2 code (DE) or 'unknown' Faciliate epidemiological analysis collection_cause required Free text (ADV Katalog) or 'unknown' Faciliate epidemiological analysis collected_by required Free text or 'unknown' Establishing chain of custody and for providing contact information manufacturer optional Free text Faciliate epidemiological analysis. Can be the manufacturer in case of a food product, sampled production place for environmental samples or animal owner for Veterinary samples designation required Free text (ADV Katalog) or 'unknown' Faciliate epidemiological analysis. Description of the type of sample, sampling location or animal host. manufacturer_type required Free text (ADV Katalog) or 'unknown' Faciliate epidemiological analysis. Type of manufacturer, sampling location or animal husbandery. sample_description required Free text or 'unknown' Faciliate epidemiological analysis. Procise description of the sample. lot_number optional Free text Faciliate epidemiological analysis. sequencing_depth required Float Assessing quality and providing ameasure of confidence in asequence. ref_coverage required Float Assessing quality and providing ameasure of confidence in asequence. q30 required Float Assessing quality and providing ameasure of confidence in asequence. <p>See an example of metadata table in the <code>config</code> folder.</p>"},{"location":"user_guide/#sequence-files","title":"Sequence files","text":"<p>The assemblies must be provided as fasta files. Wrapped and unwrapped fastas as well as multifastas are allowed. There are no special requirements for sequence headers.</p>"},{"location":"user_guide/#results","title":"Results","text":"<p>Results to be used for the next steps are located in the <code>staging</code> folder in the workdir.</p>"},{"location":"user_guide/#status-report","title":"Status report","text":"<p>A JSON report of the QC checks in the form</p> <pre><code>{\n    \"2022-0232977-01\": {\n        \"STATUS\": \"PASS\",\n        \"MESSAGES\": []\n    },\n    \"2022-0232977-02\": {\n        \"STATUS\": \"FAIL\",\n        \"MESSAGES\": [\n            \"Message checksum\",\n            \"Error message assembly\"\n        ]\n    },\n    \"2022-0232977-03\": {\n        \"STATUS\": \"FAIL\",\n        \"MESSAGES\": [\"Error message checksum\"]\n    },\n    \"2022-0232977-04\": {\n        \"STATUS\": \"FAIL\",\n        \"MESSAGES\": [\n            \"Error message metadata 1\",\n            \"Error message metadata 2\"\n        ]\n    }\n}\n</code></pre>"},{"location":"user_guide/#isolate-metadata-and-cluster-results","title":"Isolate metadata and cluster results","text":"<p>Isolate and cluster information are summarized in single JSON files which are pushed to the provided database.</p>"},{"location":"user_guide/#assemblies","title":"Assemblies","text":"<p>Assemblies are renamed so that the fastas are in the form <code>&lt;ISOLATE ID&gt;.fa</code> and stored in the path provided by the user.</p>"},{"location":"about/changelog/","title":"Release notes","text":""},{"location":"about/changelog/#0210","title":"0.2.10","text":"<p>Modified the deloyement of subworkflows to allow or concurrent versions of core and/or the subworkflows to be used on the same system without clashes Update validate to 0.2.7</p>"},{"location":"about/changelog/#029","title":"0.2.9","text":"<p>Fix grapetree crash with null distance matrix</p>"},{"location":"about/changelog/#028","title":"0.2.8","text":"<p>Fix a issue were cluster would not appear in the trees for orphan \"clusters\"</p>"},{"location":"about/changelog/#027","title":"0.2.7","text":"<p>Add trees in Newick format to the cluster sheets Fix test DB in test configuration</p>"},{"location":"about/changelog/#026","title":"0.2.6","text":"<p>Update validate to fix date parsing and better handling of isolates with lots of plasmids</p>"},{"location":"about/changelog/#025","title":"0.2.5","text":"<p>Update BakCharak Known Issue: Workflow is not working with snakemake8 for the time being. Make sure you use snakemake7.</p>"},{"location":"about/changelog/#024","title":"0.2.4","text":"<p>Fix funky run order</p>"},{"location":"about/changelog/#023","title":"0.2.3","text":"<p>Now register run name (Workdir name) in the run sheet Now waits for all critical steps to finish before commiting to database Bump validate to 0.2.5 Bump chewie to 0.3.2</p>"},{"location":"about/changelog/#022","title":"0.2.2","text":"<p>Bump geuebt-chewie to 0.3.1</p>"},{"location":"about/changelog/#021","title":"0.2.1","text":"<p>Bump geuebt-validate to 0.2.1</p>"},{"location":"about/changelog/#018","title":"0.1.8","text":"<p>Bump validate module to 0.1.1</p>"},{"location":"about/changelog/#017","title":"0.1.7","text":"<ul> <li>Fix organism name in cluster sheets</li> <li>Validate bump to 0.1.7</li> </ul>"},{"location":"about/changelog/#016","title":"0.1.6","text":"<ul> <li>Fix sample sheet creation when mutliple organisms present in dataset</li> <li>Fix creation of empty cluster and isolates desription files when the database is initially empty</li> </ul>"},{"location":"about/changelog/#015","title":"0.1.5","text":"<p>Bump geuebt-validate to v0.1.6</p>"},{"location":"about/changelog/#014","title":"0.1.4","text":"<p>Bump geuebt-validate to v0.1.5</p>"},{"location":"about/changelog/#013","title":"0.1.3","text":"<p>Fix generation of files for chewie when the database is initally empty</p>"},{"location":"about/changelog/#012","title":"0.1.2","text":"<p>Bump geuebt-chewie to v0.3.0</p>"},{"location":"about/changelog/#011","title":"0.1.1","text":"<p>Will reject samples whose field 'isolate_id' is already used in the database. THis effectivaly happens after qc validation so it will be visible only for those samples that pass qc.</p>"},{"location":"about/changelog/#010","title":"0.1.0","text":"<p>First release</p>"},{"location":"about/license/","title":"License","text":"<p>Copyright 2023, Gregoire Denay.</p> <p>Redistribution and use in source and binary forms, with or without  modification, are permitted provided that the following conditions are met:</p> <ol> <li> <p>Redistributions of source code must retain the above copyright notice, this  list of conditions and the following disclaimer.</p> </li> <li> <p>Redistributions in binary form must reproduce the above copyright notice,  this list of conditions and the following disclaimer in the documentation  and/or other materials provided with the distribution.</p> </li> <li> <p>Neither the name of the copyright holder nor the names of its contributors  may be used to endorse or promote products derived from this software without  specific prior written permission.</p> </li> </ol> <p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE  ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE  LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS  INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN  CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)  ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>"}]}